---
lab:
  az204Title: 'Lab 04: Develop solutions that use Azure Cosmos DB'
  az020Title: 'Lab 04: Develop solutions that use Azure Cosmos DB'
  az204Module: 'Module 04: Develop solutions that use Azure Cosmos DB'
  az020Module: 'Module 04: Develop solutions that use Azure Cosmos DB'
ms.openlocfilehash: 131f51f23d49b8161c5f6b8406f8239daa0f493a
ms.sourcegitcommit: 9abfe3b5a1c9ccd2f0610348052d04169573f81a
ms.translationtype: HT
ms.contentlocale: id-ID
ms.lasthandoff: 06/01/2022
ms.locfileid: "145994998"
---
# <a name="lab-04-develop-solutions-that-use-azure-cosmos-db"></a>Lab 04: Mengembangkan solusi yang menggunakan Azure Cosmos DB

## <a name="microsoft-azure-user-interface"></a>Antarmuka pengguna Microsoft Azure

Mengingat sifat dinamis dari alat cloud Microsoft, Anda mungkin mengalami perubahan antarmuka pengguna Azure yang terjadi setelah pengembangan konten pelatihan ini. Akibatnya, instruksi lab dan langkah-langkah lab mungkin tidak selaras dengan benar.

Microsoft memperbarui kursus pelatihan ini ketika komunitas memberi tahu kami tentang perubahan yang diperlukan. Namun, pembaruan cloud sering terjadi, sehingga Anda mungkin mengalami perubahan antarmuka pengguna sebelum pembaruan konten pelatihan ini. **Jika hal ini terjadi, sesuaikan dengan perubahan, lalu kerjakan perubahan di lab sesuai kebutuhan.**

## <a name="instructions"></a>Instruksi

### <a name="before-you-start"></a>Sebelum Anda memulai

#### <a name="sign-in-to-the-lab-environment"></a>Masuk ke lingkungan lab

Masuk ke mesin virtual (VM) Windows 10 Anda menggunakan kredensial berikut:

-   Nama pengguna: **Admin**

-   Kata sandi: **Pa55w.rd**

> **Catatan**: Instruktur Anda akan memberikan instruksi untuk terhubung ke lingkungan lab virtual.

#### <a name="review-the-installed-applications"></a>Meninjau aplikasi yang diinstal

Temukan taskbar di desktop Windows 10 Anda. Taskbar berisi ikon untuk aplikasi yang akan Anda gunakan di lab ini, termasuk:

-   Microsoft Edge

-   File Explorer

-   Visual Studio Code

## <a name="architecture-diagram"></a>Diagram arsitektur

![Diagram arsitektur yang menggambarkan pengguna membangun solusi data poliglot dengan membuat akun penyimpanan Azure dan akun DB Azure Cosmos.](./media/Lab04-Diagram.png)

### <a name="exercise-1-creating-data-store-resources-in-azure"></a>Latihan 1: Membuat sumber daya penyimpanan data di Azure

#### <a name="task-1-open-the-azure-portal"></a>Tugas 1: Membuka portal Azure

1.  Pada taskbar, pilih ikon **Microsoft Edge**.

1.  Di jendela browser yang terbuka, jelajahi portal Azure ([portal.azure.com](https://portal.azure.com)), lalu masuk dengan akun yang akan Anda gunakan untuk lab ini.

    > **Catatan**: Jika ini pertama kalinya Anda masuk ke portal Microsoft Azure, Anda akan diberikan penawaran tur portal. Pilih **Memulai** untuk melewati tur dan mulai menggunakan portal.

#### <a name="task-2-create-an-azure-cosmos-db-account-resource"></a>Tugas 2: Buat sumber daya akun Azure Cosmos DB

1.  Di portal Microsoft Azure, gunakan kotak teks **Cari sumber daya, layanan, dan dokumen** untuk mencari **Azure Cosmos DB** lalu di daftar hasil, pilih **Azure Cosmos DB**.

1.  Pada bilah **Azure Cosmos DB**, pilih **+ Buat**.

1.  Pada panel **Pilih opsi API**, pilih **Buat** di kotak **Core (SQL) - Disarankan**.

1.  Pada tab **Dasar** dari panel **Buat Akun Azure Cosmos DB - Core (SQL)** , lakukan tindakan berikut, lalu pilih **Tinjauan + Buat**:

    | Pengaturan                     | Tindakan                                                       |
    | --------------------------- | ------------------------------------------------------------ |
    | Daftar **Langganan**       | Pertahankan default.                                             |
    | Bagian **Grup sumber daya**  | Pilih **Buat baru**.                                       |
    | Kotak teks **Nama**           | Masukkan **Polyglotdata** dan pilih **OK**.                                      |
    | kotak teks **AccountName**    | Masukkan **polycosmos** _[yourname]_ .                            |
    | Daftar menurun **Lokasi** | Pilih wilayah Azure yang paling dekat dengan lokasi komputer lab Anda dan tempat Anda dapat membuat akun Cosmos DB. |
    | Bagian **Mode kapasitas**   | Pilih **Tanpa Server**. |
    
    Tangkapan layar berikut menampilkan pengaturan yang dikonfigurasi pada bilah **Buat Akun DB Azure Cosmos - Core (SQL)** .
    
    ![Cuplikan layar menampilkan opsi yang dikonfigurasi untuk membuat akun Azure Cosmos DB](media/l04_cosmosdb_create_summary.png)
    
1.  Pada tab **Tinjauan + Buat** panel **Buat Akun Azure Cosmos DB - Core (SQL)** , tinjau opsi yang Anda pilih selama langkah sebelumnya. 

1.  Pilih **Buat** untuk membuat akun Azure Cosmos DB menggunakan konfigurasi yang Anda tentukan.

    > **Catatan**: Tunggu hingga tugas pembuatan selesai sebelum Anda melanjutkan dengan lab ini.

1.  Pilih **Buka sumber daya**.

1.  Pada panel **akun Azure Cosmos DB**, temukan bagian **Pengaturan**, lalu pilih tautan **Kunci**.

1.  Di panel **Kunci**, pada tab **Kunci Baca-tulis**, catat nilai **URI**, **PRIMARY KEY**, dan kotak teks **PRIMARY CONNECTION STRING**. Anda akan menggunakan nilai ini nanti di lab ini.

#### <a name="task-3-create-an-azure-storage-account-resource"></a>Tugas 3: Buat sumber daya akun Azure Storage

1.  Di portal Microsoft Azure, gunakan kotak teks **Cari sumber daya, layanan, dan dokumen** untuk mencari **Akun penyimpanan** dan dalam daftar hasil, pilih **Akun penyimpanan** .

1.  Pada panel **Akun penyimpanan**, pilih **+ Buat**.

1.  Pada tab **Dasar** pada panel **Buat akun penyimpanan**, lakukan tindakan berikut, lalu pilih **Tinjauan + Buat**:


    | Pengaturan | Tindakan |
    | --- | --- |
    | Daftar **Langganan** | Pertahankan default |
    | Bagian **Grup sumber daya**  | Pilih **PolyglotData**. |
    | Kotak teks **Nama akun penyimpanan** | Masukkan **polystor** _[yourname]_ . |
    | Daftar menurun **Wilayah**   | Pilih wilayah yang sama tempat Anda membuat akun Cosmos DB sebelumnya dalam latihan ini.  |
    | Bagian **Performa** | Pilih **Standar**. |
    | Daftar menurun **Redundansi** | Pilih **Penyimpanan redundan secara lokal (LRS)** . |

    Cuplikan layar berikut menampilkan pengaturan yang dikonfigurasi pada bilah **Buat akun penyimpanan**.

    ![Cuplikan layar menampilkan opsi yang dikonfigurasi untuk membuat akun Azure storage](media/l04_storage_create_summary.png)

1.  Pada tab **Tinjauan + Buat** panel **Buat akun penyimpanan**, tinjau opsi yang Anda pilih selama langkah sebelumnya.

1.  Pilih **Buat** untuk membuat akun penyimpanan menggunakan konfigurasi yang Anda tentukan.

    > **Catatan**: Tunggu hingga tugas pembuatan selesai sebelum Anda melanjutkan ke lab ini.

#### <a name="review"></a>Tinjauan

Dalam latihan ini, Anda membuat sumber daya Azure yang Anda perlukan untuk solusi data polyglot yang akan Anda terapkan di lab ini. Sumber daya Azure yang Anda buat mencakup akun Azure Cosmos DB dan akun Azure Storage.

### <a name="exercise-2-review-and-upload-data"></a>Latihan 2: Tinjauan dan unggah data

#### <a name="task-1-upload-images-to-azure-blob-storage"></a>Tugas 1: Unggah gambar ke Azure Blob Storage

1.  Di panel navigasi portal Azure, navigasikan kembali ke panel **Akun penyimpanan**, lalu pilih akun penyimpanan **polystor** _[yourname]_ yang Anda buat di lab pada latihan sebelumnya.

1.  Pada panel akun penyimpanan **polystor** _[yourname]_ , pilih tautan **Kontainer** di bagian **Penyimpanan data**.

1.  Di bagian **Kontainer**, pilih **+ Kontainer**.

1.  Di jendela pop-up **Kontainer baru**, lakukan tindakan berikut, lalu pilih **Buat**:

    | Pengaturan | Tindakan |
    | --- | --- |
    | Kotak teks **Nama** | Masukkan **gambar**. |
    | Daftar menurun **Tingkat akses publik** | Pilih **Blob (akses baca anonim hanya untuk blob)** . |

1.  Kembali ke bagian **Kontainer**, pilih kontainer **gambar** yang baru dibuat.

1.  Temukan bagian **Pengaturan** pada panel **Kontainer**, lalu pilih tautan **Properti**.

1.  Di panel **Properti**, catat dan rekam nilainya di kotak teks **URL**. Anda akan menggunakan nilai ini nanti di lab ini.

1.  Temukan dan pilih tautan **Ringkasan** pada bilah.

1.  Pada panel, pilih **Unggah**.

1.  Dalam pop-up **Unggah blob**, lakukan tindakan berikut:

    a.  Di bagian **File**, pilih ikon **Folder**.

    b.  Di jendela **File Explorer**, telusuri ke file gambar **Allfiles (F):\\Allfiles\\Labs\\04\\Starter\\Images**, pilih semua 42 individual **.jpg**, lalu pilih **Buka**.

    c.  Pastikan **Timpa jika file sudah ada** dipilih, lalu pilih **Unggah**.

    > **Catatan**: Tunggu hingga semua blob diunggah sebelum Anda melanjutkan lab ini.

#### <a name="task-2-review-json-data"></a>Tugas 2: Tinjauan data JSON

1.  Dari komputer lab, mulai Visual Studio Code.

1.  Dari menu **File**, pilih **Buka File**, telusuri ke **Allfiles (F):\\Allfiles\\Labs\\04\\Starter\\AdventureWorks\\AdventureWorks.Upload**, pilih **models.json**, lalu pilih **Buka**.

1.  Tinjauan format file **models.json** dan perhatikan bahwa file tersebut berisi larik objek JSON, dengan larik objek bertumpuk yang merupakan bagian dari properti **Produk**.

    > **Catatan**: Upaya ini akan menentukan kelas yang akan Anda tentukan untuk membatalkan serialisasi konten file JSON sebelum mengunggahnya ke koleksi Cosmos DB.

1.  Dalam file **models.json**, perhatikan bahwa salah satu properti bernama **Category**.

    > **Catatan**: Anda akan menggunakan properti **Category** untuk menentukan partisi koleksi target Cosmos DB.

1.  Tutup Visual Studio Code.

#### <a name="task-3-create-a-cosmos-db-database-and-collection-and-perform-a-json-data-upload"></a>Tugas 3: Buat database dan koleksi Cosmos DB, dan lakukan unggahan data JSON

1.  Pada layar **Mulai**, pilih petak peta **Visual Studio Code**.

1.  Dari menu **File**, pilih **Buka Folder**.

1.  Di jendela **File Explorer** yang terbuka, telusuri ke **Allfiles (F):\\Allfiles\\Labs\\04\\Starter\\AdventureWorks**, lalu pilih **Pilih Folder**.

1.  Di jendela **Visual Studio Code**, pada Bilah Menu, pilih **Terminal** lalu pilih **Terminal Baru**.

1.  Di terminal, pastikan direktori saat ini diatur menjadi **AdventureWorks** (atau ubah menjadi begitu jika tidak), lalu jalankan perintah berikut untuk mengalihkan konteks terminal Anda ke folder **AdventureWorks.Upload**:

    ```
    cd .\AdventureWorks.Upload\
    ```

    > **Catatan**: Sebelum Anda melakukan langkah berikutnya, buka Windows Explorer dan hapus atribut **Baca saja** dari file **Allfiles (F):\\Allfiles\\Labs\\04\\Starter\\AdventureWorks\\AdventureWorks.Upload\\AdventureWorks.Upload.csproj**

1.  Dari perintah terminal, jalankan perintah berikut untuk menambahkan pustaka klien Azure Cosmos DB .NET ke proyek yang sedang dibuka:

    ```
    dotnet add package Microsoft.Azure.Cosmos --version 3.20.1
    ```

    > **Catatan**: Perintah **dotnet add package** akan menambahkan paket **Microsoft.Azure.Cosmos** dari **NuGet**. Untuk informasi selengkapnya, baca [Microsoft.Azure.Cosmos](https://www.nuget.org/packages/Microsoft.Azure.Cosmos/3.20.1).

1.  Amati hasil build yang tercetak di terminal. Build harus berhasil diselesaikan tanpa kesalahan atau pesan peringatan.

1.  Di panel **Penjelajah** dari jendela **Visual Studio Code**, luaskan proyek **AdventureWorks.Upload**.

1.  Buka file **Program.cs**.

1.  Dalam file **Program.cs**, tinjau arahan **using** dan perhatikan bahwa arahan tersebut menyertakan **Microsoft.Azure.Cosmos**, **System.IO;** , **System.Text.Json**, **System.Threading.Tasks**, dan **System.Collections.Generic**. Arahan ini memungkinkan unggahan item JSON secara asinkron dari file lokal di komputer lab Anda ke koleksi di database Cosmos DB.

1.  Dalam file **Program.cs**, pada baris 14, atur nilai **EndpointUrl** dengan mengganti string kosong dengan properti **URI** dari akun Cosmos DB yang Anda catat sebelumnya di lab ini. Pastikan bahwa nilainya diapit oleh tanda kutip ganda.

1.  Pada baris 15, atur nilai **AuthorizationKey** dengan mengganti string kosong dengan properti **KUNCI UTAMA** akun Cosmos DB yang Anda cata sebelumnya di lab ini. Pastikan bahwa nilainya diapit oleh tanda kutip ganda.

1.  Pada baris 18, atur nilai **PrimaryKey** dengan mengganti string kosong dengan **"/Category"** .

1.  Pada baris 19, tetapkan nilai **JsonFilePath** dengan mengganti string kosong dengan **"F:\\\\Allfiles\\\\Labs\\\\04\\\\Starter\\\\AdventureWorks\\\\AdventureWorks.Upload\\\\models.json"** .

1.  Dalam blok coba, perhatikan pemanggilan metode **CreateDatabaseIfNotExistsAsync** dari kelas **CosmosClient**. Cara ini akan membuat database jika belum ada.

1.  Perhatikan pemanggilan metode **DefineContainer** dari kelas **Database**. Metode ini akan membuat kontainer yang akan menampung item JSON jika belum ada.

    > **Catatan**: Metode **DefineContainer** menyertakan opsi meminimalkan biaya yang dengannya Anda dapat mengubah kebijakan pengindeksan default (yang secara otomatis mengindeks semua atribut).

1.  Perhatikan pernyataan **using** yang bergantung pada objek **StreamReader** untuk membaca item JSON dari file teks dan mendeserialisasinya menjadi objek kelas **Model** yang didefinisikan lebih lanjut di **Program.cs**.

1.  Perhatikan perulangan ForEach yang mengulangi koleksi objek yang dideserialisasi dan secara asinkron menyisipkan masing-masing objek ke dalam koleksi target.

1.  Tinjauan kelas **Model** dan **Produk** yang mencerminkan format objek yang disimpan dalam file berformat JSON yang Anda tinjau sebelumnya di lab ini.

1.  Simpan dan tutup file **Program.cs**.

    > **Catatan**: Pilih **Timpa** jika Anda menerima konfirmasi bahwa file berupa baca saja.

1. Di terminal, jalankan perintah berikut untuk memulihkan paket NuGet yang hilang dan membangun proyek di folder:

    ```
    dotnet build
    ```

    > **Catatan**: Perintah **dotnet build** akan secara otomatis memulihkan paket NuGet yang hilang sebelum membangun semua proyek dalam folder.

1.  Dari perintah terminal, jalankan perintah berikut untuk menjalankan aplikasi konsol .NET Core:

    ```
    dotnet run
    ```

    > **Catatan**: Perintah **dotnet run** akan secara otomatis membuat perubahan apa pun pada proyek dan kemudian memulai aplikasi web tanpa debugger yang terpasang. Perintah akan menampilkan pesan yang menunjukkan progres pemuatan data, termasuk jumlah item yang dimasukkan ke dalam koleksi target dan durasi operasi penyisipan.

1.  Amati hasil menjalankan perintah yang tercetak di terminal. Eksekusinya tentu berhasil diselesaikan, menampilkan pesan tentang ada 119 item yang dimasukkan ke dalam koleksi target Cosmos DB.

1.  Pilih **Kill Terminal** (ikon **Recycle Bin**) untuk menutup panel terminal dan semua proses terkait.

#### <a name="task-4-validate-json-data-upload"></a>Tugas 4: Memvalidasi unggahan data JSON

1.  Di komputer lab Anda, alihkan ke jendela browser **Microsoft Edge** yang menampilkan portal Microsoft Azure.

1. Di portal Microsoft Azure, pilih kotak teks **Cari sumber daya, layanan, dan dokumen**, dalam daftar **Sumber daya terbaru**, pilih **polycosmos** _[yourname]_  Akun Azure Cosmos DB yang Anda buat sebelumnya di lab ini.

1.  Pada panel **akun Azure Cosmos DB**, temukan dan pilih tautan **Data Explorer** pada panel.

1.  Di panel **Data Explorer**, luaskan node basis data **Retail**.

1.  Perluas node kontainer **Online**, lalu pilih **Kueri SQL Baru**.

    > **Catatan**: Label untuk opsi ini mungkin disembunyikan. Anda dapat menampilkan label dengan mengarahkan kursor ke ikon di panel **Data Explorer**.

1.  Pada tab kueri, masukkan teks berikut:

    ```
    SELECT * FROM models
    ```

1.  Pilih **Jalankan Kueri**, lalu amati daftar item JSON yang dikembalikan oleh kueri.

1.  Kembali ke editor kueri, ganti teks yang ada dengan teks berikut:

    ```
    SELECT VALUE COUNT(1) FROM models
    ```

1.  Pilih **Jalankan Kueri**, lalu amati hasil dari **COUNT** operasi gabungan.

1.  Beralih kembali ke jendela **Visual Studio Code**.

#### <a name="review"></a>Tinjauan

Dalam latihan ini, Anda menggunakan .NET SDK untuk Azure Cosmos DB untuk memasukkan data ke dalam Azure Cosmos DB. Aplikasi web yang Anda implementasikan selanjutnya akan menggunakan data ini.

### <a name="exercise-3-configure-a-net-web-application"></a>Latihan 3: Mengonfigurasikan aplikasi web .NET

#### <a name="task-1-update-references-to-data-stores-and-build-the-web-application"></a>Tugas 1: Perbarui referensi ke penyimpanan data dan bangun aplikasi web

1.  Di panel **Penjelajah** pada jendela **Visual Studio Code**, luaskan proyek **AdventureWorks.Web**.

1.  Buka file **appsettings.json**.

1.  Di objek JSON pada baris 3, temukan jalur **ConnectionStrings.AdventureWorksCosmosContext**. Perhatikan bahwa nilai saat ini kosong:

    ```
    "ConnectionStrings": {
        "AdventureWorksCosmosContext": "",
    },
    ```

1.  Perbarui nilai properti **AdventureWorksCosmosContext** dengan mengatur nilainya menjadi **PRIMARY CONNECTION STRING** akun Azure Cosmos DB yang Anda rekam sebelumnya di lab ini.

1.  Di objek JSON pada baris 6, temukan jalur **Settings.BlobContainerUrl**. Perhatikan bahwa nilai saat ini kosong:

    ```
    "Settings": {
        "BlobContainerUrl": "",
        ...
    }
    ```

1.  Perbarui properti **BlobContainerUrl** dengan mengatur nilainya menjadi properti **URL** kontainer blob Azure Storage bernama **gambar** yang Anda cata sebelumnya di lab ini.

1.  Simpan file **appsettings.json** dan tutup.

    > **Catatan**: Pilih **Timpa** jika Anda menerima konfirmasi bahwa file berupa baca saja.

1.  Di jendela **Visual Studio Code**, pilih **AdventureWorks.Context**, aktifkan menu pintasan, lalu pilih **Buka di Terminal Terintegrasi**.

    > **Catatan**:Sebelum Anda melakukan langkah berikutnya, buka Windows Explorer dan hapus atribut Baca-saja dari file **Allfiles (F):\Allfiles\Labs\04\Starter\AdventureWorks\AdventureWorks.Context\AdventureWorks.Context.csproj**

1.  Dari perintah terminal, pastikan direktori saat ini diatur menjadi **AdventureWorks.Context** (atau ubah ke direktori tersebut jika belum), lalu jalankan perintah berikut untuk mengimpor **Microsoft.Azure.Cosmos** dari NuGet:

    ```
    dotnet add package Microsoft.Azure.Cosmos --version 3.20.1
    ```

1.  Dari perintah terminal, jalankan perintah berikut untuk membangun aplikasi web .NET:

    ```
    dotnet build
    ```

1.  Amati hasil build yang tercetak di terminal. Build harus berhasil diselesaikan tanpa kesalahan atau pesan peringatan.

#### <a name="task-2-configure-connectivity-to-azure-cosmos-db"></a>Tugas 2: Mengonfigurasikan konektivitas ke Azure Cosmos DB

1.  Di panel **Penjelajah** dari jendela **Visual Studio Code**, luaskan proyek **AdventureWorks.Context**.

1.  Dari menu pintasan node folder **AdventureWorks.Context**, pilih **File Baru**.

1.  Pada permintaan berkas baru, masukkan **AdventureWorksCosmosContext.cs**.

1.  Dari tab editor kode untuk file **AdventureWorksCosmosContext.cs**, tambahkan baris kode berikut untuk mengimpor namespace **AdventureWorks.Models** dari proyek **AdventureWorks.Models** yang dirujuk :

    ```
    using AdventureWorks.Models;
    ```

1.  Tambahkan baris kode berikut untuk mengimpor namespace **Microsoft.Azure.Cosmos** dan **Microsoft.Azure.Cosmos.Linq** dari paket **Microsoft.Azure.Cosmos** yang diimpor dari NuGet:

    ```
    using Microsoft.Azure.Cosmos;
    using Microsoft.Azure.Cosmos.Linq;
    ```

1.  Tambahkan baris kode berikut untuk menyertakan arahan **using** untuk namespace bawaan yang akan digunakan file ini:

    ```
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    ```

1.  Masukkan kode berikut untuk menambahkan blok namespace **AdventureWorks.Context**:

    ```
    namespace AdventureWorks.Context
    {
    }
    ```

1.  Dalam ruang nama **AdventureWorks.Context**, masukkan kode berikut untuk membuat kelas **AdventureWorksCosmosContext** baru:

    ```
    public class AdventureWorksCosmosContext
    {
    }
    ```

1.  Perbarui deklarasi kelas **AdventureWorksCosmosContext** dengan menambahkan spesifikasi yang menunjukkan bahwa kelas ini akan mengimplementasikan antarmuka **IAdventureWorksProductContext**:

    ```
    public class AdventureWorksCosmosContext : IAdventureWorksProductContext
    {
    }
    ```

1.  Dalam kelas **AdventureWorksCosmosContext**, masukkan kode berikut untuk membuat variabel *Container* hanya-baca baru bernama **_container**:

    ```
    private readonly Container _container;
    ```

1.  Di dalam kelas **AdventureWorksCosmosContext**, tambahkan konstruktor baru dengan tanda tangan berikut:

    ```
    public AdventureWorksCosmosContext(string connectionString, string database = "Retail", string container = "Online")
    {
    }
    ```

1.  Di dalam konstruktor, tambahkan blok kode berikut untuk membuat instans baru kelas **CosmosClient**, lalu dapatkan instans **Database** dan **Container** dari klien:

    ```
    _container = new CosmosClient(connectionString)
        .GetDatabase(database)
        .GetContainer(container);
    ```

1.  Dalam kelas **AdventureWorksCosmosContext**, tambahkan metode **FindModelAsync** baru dengan tanda tangan berikut:

    ```
    public async Task<Model> FindModelAsync(Guid id)
    {
    }
    ```

1.  Dalam metode **FindModelAsync**, tambahkan blok kode berikut untuk membuat kueri LINQ, ubah menjadi pengulangan, ulangi kumpulan hasil, lalu kembalikan satu item dalam kumpulan hasil:

    ```
    var iterator = _container.GetItemLinqQueryable<Model>()
        .Where(m => m.id == id)
        .ToFeedIterator<Model>();
    List<Model> matches = new List<Model>();
    while (iterator.HasMoreResults)
    {
        var next = await iterator.ReadNextAsync();
        matches.AddRange(next);
    }
    return matches.SingleOrDefault();
    ```

1.  Dalam kelas **AdventureWorksCosmosContext**, tambahkan metode **GetModelsAsync** baru dengan tanda tangan berikut:

    ```
    public async Task<List<Model>> GetModelsAsync()
    {
    }
    ```

1.  Dalam metode **GetModelsAsync**, tambahkan blok kode berikut untuk menjalankan kueri SQL, dapatkan pengulangan hasil kueri, ulangi kumpulan hasil, lalu kembalikan gabungan semua hasil:

    ```
    string query = $@"SELECT * FROM items";
    var iterator = _container.GetItemQueryIterator<Model>(query);
    List<Model> matches = new List<Model>();
    while (iterator.HasMoreResults)
    {
        var next = await iterator.ReadNextAsync();
        matches.AddRange(next);
    }
    return matches;
    ```

1.  Dalam kelas **AdventureWorksCosmosContext**, tambahkan metode **FindProductAsync** baru dengan tanda tangan berikut:

    ```
    public async Task<Product> FindProductAsync(Guid id)
    {
    }
    ```

1.  Dalam metode **FindProductAsync**, tambahkan blok kode berikut untuk menjalankan kueri SQL, dapatkan pengulangan hasil kueri, ulangi kumpulan hasil, lalu kembalikan satu item dalam kumpulan hasil:

    ```
    string query = $@"SELECT VALUE products
                        FROM models
                        JOIN products in models.Products
                        WHERE products.id = '{id}'";
    var iterator = _container.GetItemQueryIterator<Product>(query);
    List<Product> matches = new List<Product>();
    while (iterator.HasMoreResults)
    {
        var next = await iterator.ReadNextAsync();
        matches.AddRange(next);
    }
    return matches.SingleOrDefault();
    ```

1.  Simpan dan tutup file **AdventureWorksCosmosContext.cs**.

1.  Dari perintah terminal, dengan direktori saat ini diatur menjadi **AdventureWorks.Context**, jalankan perintah berikut untuk membangun aplikasi web .NET:

    ```
    dotnet build
    ```

    > **Catatan**: Jika ada kesalahan pembuatan, tinjau file **AdventureWorksCosmosContext.cs** di folder **Allfiles (F):\\Allfiles\\Labs\\04\\Solution\\AdventureWorks\\AdventureWorks.Context**.

#### <a name="task-3-review-the-net-application-startup-logic"></a>Tugas 3: Tinjauan logika penyalaan aplikasi .NET

1.  Di panel **Penjelajah** pada jendela **Visual Studio Code**, luaskan proyek **AdventureWorks.Web**.

1.  Buka file **Startup.cs**.

1.  Di kelas **Startup**, perhatikan metode **ConfigureProductService** yang ada:

    ```
    public void ConfigureProductService(IServiceCollection services)
    {
        services.AddScoped<IAdventureWorksProductContext, AdventureWorksCosmosContext>(provider =>
            new AdventureWorksCosmosContext(
                _configuration.GetConnectionString(nameof(AdventureWorksCosmosContext))
            )
        );
    }
    ```

    > **Catatan**: Layanan produk menggunakan Cosmos DB sebagai database-nya.

1.  Tutup file **Startup.cs** tanpa melakukan modifikasi apa pun.

#### <a name="task-4-validate-that-the-net-application-successfully-connects-to-data-stores"></a>Tugas 4: Pastikan aplikasi .NET berhasil terhubung ke penyimpanan data

1.  Dalam Visual Studio Code, dari terminal perintah, jalankan perintah berikut untuk mengalihkan konteks terminal Anda ke folder **AdventureWorks.Web**:

    ```
    cd ..\AdventureWorks.Web\
    ```

1.  Dari perintah terminal, jalankan perintah berikut untuk menjalankan aplikasi web ASP.NET:

    ```
    dotnet run
    ```

    > **Catatan**: Perintah **dotnet run** akan secara otomatis membuat perubahan apa pun pada proyek dan kemudian memulai aplikasi web tanpa debugger yang terpasang. Perintah akan menampilkan URL aplikasi yang sedang berjalan dan port yang ditetapkan.

1.  Pada taskbar, pilih ikon **Microsoft Edge**.

1.  Di jendela browser yang terbuka, jelajahi aplikasi web yang sedang berjalan (<http://localhost:5000>).

1.  Dalam aplikasi web, amati daftar model yang ditampilkan dari halaman depan.

1.  Temukan model **Touring-1000**, lalu pilih **Lihat Detail**.

1.  Pada halaman detail produk **Touring-1000**, tinjau daftar opsi.

1.  Tutup jendela browser yang menampilkan aplikasi web Anda.

1.  Beralih ke jendela **Visual Studio Code**, lalu pilih **Hentikan Terminal** (ikon **Recycle Bin**) untuk menutup terminal yang saat ini terbuka dan semua proses terkait.

#### <a name="review"></a>Tinjauan

Dalam latihan ini, Anda sudah menulis kode C# untuk menanyakan koleksi Azure Cosmos DB menggunakan .NET SDK.

### <a name="exercise-4-clean-up-your-subscription"></a>Latihan 4: Membersihkan langganan Anda 

#### <a name="task-1-open-azure-cloud-shell"></a>Tugas 1: Membuka Azure Cloud Shell

1.  Di portal Microsoft Azure, pilih ikon **Cloud Shell** ![ikon Cloud Shell](./media/az204_lab_CloudShell.png) untuk membuka sesi Bash baru. Jika Cloud Shell default ke sesi PowerShell, pilih **PowerShell** dan, di menu drop-down, pilih **Bash**.

     > **Catatan**: Jika ini pertama kalinya Anda memulai **Cloud Shell**, saat diminta untuk memilih **Bash** atau **PowerShell**, pilih **PowerShell**. Saat Anda melihat pesan **Anda tidak memiliki penyimpanan yang terinstal**, pilih langganan yang Anda gunakan di lab ini, lalu pilih **Buat penyimpanan**.

#### <a name="task-2-delete-resource-groups"></a>Tugas 2: Menghapus grup sumber daya

1.  Di panel **Cloud Shell**, jalankan perintah berikut untuk menghapus grup sumber daya **PolyglotData**:

    ```
    az group delete --name PolyglotData --no-wait --yes
    ```
    
    > **Catatan**: Perintah dijalankan secara asinkron (sebagaimana ditentukan oleh parameter *--no-wait*). Oleh karena itu, sementara Anda dapat menjalankan perintah Azure CLI lain segera setelahnya dalam sesi Bash yang sama, diperlukan beberapa menit sebelum grup sumber daya benar-benar dihapus.

1.  Tutup panel **Cloud Shell** di portal.

#### <a name="task-3-close-the-active-applications"></a>Tugas 3: Menutup aplikasi yang aktif

1.  Tutup aplikasi Microsoft Edge yang sedang berjalan.

1.  Tutup aplikasi Visual Studio Code yang sedang berjalan.

#### <a name="review"></a>Tinjauan

Dalam latihan ini, Anda membersihkan langganan Anda dengan menghapus grup sumber daya yang digunakan di lab ini.
