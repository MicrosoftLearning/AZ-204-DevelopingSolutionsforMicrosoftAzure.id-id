---
lab:
  az204Title: 'Lab 11: Monitor services that are deployed to Azure'
  az020Title: 'Lab 11: Monitor services that are deployed to Azure'
  az204Module: 'Module 11: Monitor and optimize Azure solutions'
  az020Module: 'Module 11: Monitor and optimize Azure solutions'
ms.openlocfilehash: 442177b32dbee3346b8b81216c61ca5337826fe1
ms.sourcegitcommit: 9abfe3b5a1c9ccd2f0610348052d04169573f81a
ms.translationtype: HT
ms.contentlocale: id-ID
ms.lasthandoff: 06/01/2022
ms.locfileid: "145995043"
---
# <a name="lab-11-monitor-services-that-are-deployed-to-azure"></a>Lab 11: Memantau layanan yang disebarkan ke Azure

## <a name="microsoft-azure-user-interface"></a>Antarmuka pengguna Microsoft Azure

Mengingat sifat dinamis dari alat cloud Microsoft, Anda mungkin mengalami perubahan antarmuka pengguna Azure yang terjadi setelah pengembangan konten pelatihan ini. Akibatnya, instruksi lab dan langkah-langkah lab mungkin tidak selaras dengan benar.

Microsoft memperbarui kursus pelatihan ini ketika komunitas memberi tahu kami tentang perubahan yang diperlukan. Tetapi, pembaruan cloud sering terjadi, sehingga Anda mungkin mengalami perubahan antarmuka pengguna sebelum pembaruan konten pelatihan ini. **Jika hal ini terjadi, sesuaikan dengan perubahan, lalu kerjakan perubahan di lab sesuai kebutuhan.**

## <a name="instructions"></a>Instruksi

### <a name="before-you-start"></a>Sebelum Anda memulai

#### <a name="sign-in-to-the-lab-environment"></a>Masuk ke lingkungan lab

Masuk ke mesin virtual (VM) Windows 10 Anda menggunakan kredensial berikut:
    
-   Nama pengguna: **Admin**

-   Kata sandi: **Pa55w.rd**

> **Catatan**: Instruktur Anda akan memberikan instruksi untuk terhubung ke lingkungan lab virtual.

#### <a name="review-the-installed-applications"></a>Meninjau aplikasi yang diinstal

Temukan taskbar di desktop Windows 10 Anda. Taskbar berisi ikon untuk aplikasi yang akan Anda gunakan di lab ini, termasuk:
    
-   Microsoft Edge

-   File Explorer

-   Visual Studio Code

-   Azure PowerShell

## <a name="architecture-diagram"></a>Diagram arsitektur

![Diagram arsitektur yang menggambarkan pemantauan layanan yang disebarkan ke Azure](./media/Lab11-Diagram.png)

### <a name="exercise-1-create-and-configure-azure-resources"></a>Latihan 1: Membuat dan mengonfigurasi sumber daya Azure

#### <a name="task-1-open-the-azure-portal"></a>Tugas 1: Membuka portal Azure

1.  Pada taskbar, pilih ikon **Microsoft Edge**.

1.  Di jendela browser, telusuri portal Microsoft Azure ([portal.azure.com](https://portal.azure.com)), lalu masuk dengan akun yang akan Anda gunakan untuk lab ini.

    > **Catatan**: Jika ini pertama kalinya Anda masuk ke portal Microsoft Azure, Anda akan diberikan penawaran tur portal. Pilih **Memulai** untuk melewati tur dan mulai menggunakan portal.

#### <a name="task-2-create-an-application-insights-resource"></a>Tugas 2: Membuat sumber daya Application Insights

1.  Di portal Microsoft Azure, gunakan kotak teks **Cari sumber daya, layanan, dan dokumen** di bagian atas halaman untuk mencari **Application Insights** lalu, dalam daftar hasil, pilih **Application Insights**.

1.  Pada panel **Application Insights**, pilih **+ Buat**.

1.  Pada panel **Application Insights**, pada tab **Dasar-dasar**, lakukan tindakan berikut, dan pilih **Tinjauan + Buat**:
    
    | Pengaturan                         | Tindakan                                                       |
    | ------------------------------- | ------------------------------------------------------------ |
    | Daftar menurun **Langganan** | Pertahankan nilai default.                                    |
    | Bagian **Grup sumber daya**      | Pilih **Buat baru**, masukkan **MonitoredAssets**, lalu pilih **OK**. |
    | Kotak teks **nama**     | **instrm** _[yourname]_ .                           |
    | Daftar menurun **Wilayah**       | Pilih wilayah Azure tempat Anda dapat menyebarkan Azure Service Bus. |
    | Bagian **Mode Sumber Daya** | Pilih opsi **Berbasis ruang kerja**.|
    | Bagian **DETAIL RUANG KERJA** | Pertahankan nilai default untuk daftar menurun **Langganan** dan **Ruang Kerja Analitik Log**.|
    
    Cuplikan layar berikut menampilkan pengaturan yang dikonfigurasi pada panel **Application Insights**.

       ![Membuat panel instans Azure Application Insights](./media/l11_create_app_insights_portal.png)
     
1.  Pada tab **Tinjauan + Buat**, tinjau opsi yang Anda pilih di langkah sebelumnya.

1.  Pilih **Buat** untuk membuat instans **Application Insights** dengan menggunakan konfigurasi yang Anda tentukan.

    > **Catatan**: Tunggu hingga tugas pembuatan selesai sebelum Anda melanjutkan ke lab ini.

1.  Pada panel **Microsoft.AppInsights \| Gambaran Umum**, pilih tombol **Buka sumber daya** untuk menavigasi ke panel sumber daya **Application Insights** yang baru dibuat.

1.  Pada panel **Application Insights**, di bagian **Konfigurasikan**, pilih tautan **Properti**.

1.  Pada panel **Properti**, di samping entri **Kunci Instrumentasi**, pilih tombol **Salin ke clipboard**, lalu catat nilai yang disalin. Anda akan menggunakannya nanti di lab ini.

    > **Catatan**: Kunci tersebut digunakan oleh aplikasi klien untuk terhubung ke sumber daya **Application Insights** tertentu.

### <a name="task-3-create-an-azure-web-api-resource"></a>Tugas 3: Membuat sumber daya API Web Azure

1.  Di portal Microsoft Azure, gunakan kotak teks **Cari sumber daya, layanan, dan dokumen** di bagian atas halaman untuk mencari **App Services** lalu, dalam daftar hasil, pilih **App Services**.

1.  Pada panel **App Services**, pilih **+ Buat**.
    
1.  Pada panel **Buat Aplikasi Web**, pada tab **Dasar**, lakukan tindakan berikut, lalu pilih **Berikutnya: Penyebaran**:

    | Pengaturan                         | Tindakan                                                       |
    | ------------------------------- | ------------------------------------------------------------ |
    | Daftar menurun **Langganan** | Pertahankan nilai default.                                    |
    | Daftar menurun **Grup sumber daya**      |Pilih **MonitoredAssets**. |
    | Kotak teks **nama**     | Masukkan **smpapi** _[yourname]_ |
    | Bagian **Perenerbitan**       | Pilih **Kode**. |
    | Daftar menurun **Tumpukan runtime** | Pilih **.NET Core 3.1 (LTS)** .|
    | Bagian **Sistem Operasi** |  Pilih **Windows**.|
    | Daftar menurun **Wilayah** |  Pilih wilayah yang sama dengan yang Anda pilih sebagai lokasi sumber daya **Instans Aplikasi**. |
    | Bagian **Paket App Service** |  Pilih **Buat baru**. |
    | Kotak teks **nama** |  Masukkan **MonitoredPlan**, lalu pilih **OK**.|
    |  Bagian **SKU dan ukuran** |  Pertahankan nilai default. |

1.  Pada tab **Penyebaran**, pilih **Berikutnya: Jaringan (pratinjau)** dan pilih **Berikutnya: Pemantauan**.

1.  Pada tab **Pemantauan**, lakukan tindakan berikut, lalu pilih **Tinjauan + Buat**:

    | Pengaturan                         | Tindakan                                                       |
    | ------------------------------- | ------------------------------------------------------------ |
    | Bagian **Aktifkan Application Insights** | Pastikan **Ya** dipilih.                                    |
    | Daftar menurun **Application Insights**     | Pilih sumber daya Application Insights **instrm** _[yourname]_ yang Anda buat sebelumnya di lab ini.|

1.  Pada tab **Tinjauan + Buat**, tinjau opsi yang Anda pilih di langkah sebelumnya.

1.  Pilih **Buat** untuk membuat API web dengan menggunakan konfigurasi yang Anda tentukan.

    > **Catatan**: Tunggu hingga tugas pembuatan selesai sebelum Anda melanjutkan ke lab ini.

1.  Pada panel **Gambaran Umum** penyebaran, pilih tombol **Buka sumber daya** untuk menavigasi ke panel dari API web Azure yang baru dibuat.

1.  Pada panel **App Service**, di bagian **Pengaturan**, pilih tautan **Konfigurasi**.

1.  Di bagian **Konfigurasi**, lakukan tindakan berikut:

    a.  Pada tab **Pengaturan aplikasi**, pilih **Tampilkan Nilai** untuk menampilkan rahasia yang terkait dengan API web Anda.

    b.  Catat nilai yang mewakili kunci **APPINSIGHTS\_INSTRUMENTATIONKEY**. Nilai ini diatur secara otomatis saat Anda membuat sumber daya API web.

1.  Pada panel **App Service**, di bagian **Pengaturan**, pilih tautan **Properti**.

1.  Di bagian **Properti**, catat nilai tautan **URL**. Anda akan menggunakan nilai ini nanti di lab untuk mengirim permintaan ke API web.

#### <a name="task-4-configure-web-api-autoscale-options"></a>Tugas 4: Mengonfigurasi opsi penskalaan otomatis API web

1.  Pada panel **App Service**, di bagian **Pengaturan**, pilih tautan **Peluasan Skala (Paket App Service)** .

1.  Di bagian **Peluasan Skala**, lakukan tindakan berikut, lalu pilih **Simpan**:

    | Pengaturan                         | Tindakan                                                       |
    | ------------------------------- | ------------------------------------------------------------ |
    | Bagian **Peluasan Skala** | Pilih **Skala otomatis kustom**.|
    | Kotak teks **Nama pengaturan skala otomatis**     | Masukkan **ComputeScaler**.|
    | Daftar menurun **Grup sumber daya**     |Pilih **MonitoredAssets**. |
    | Bagian **mode skala**      | Pilih **Skalakan berdasarkan metrik**. |
    | Kotak teks **Minimum** di bagian **Batas instans** | Masukkan **2**.|
    | Kotak teks **Maksimum** di bagian **Batas instans** | Masukkan **8**.|
    | Kotak teks **Default** di bagian **Batas instans** | Masukkan **3**. |

    Cuplikan layar berikut menampilkan pengaturan yang dikonfigurasi di bagian **Peluasan Skala** pada panel **App Service**.

    ![Kondisi skala default pada panel API web Azure](./media/l11_scale_web_app_default.png)

    | Pengaturan                         | Tindakan                                                       |
    | ------------------------------- | ------------------------------------------------------------ |
    | Bagian **Aturan** |  Pilih **Tambahkan aturan**.|
    | Panel **Aturan skala** | Pertahankan nilai default untuk semua pengaturan, lalu pilih **Tambahkan**.|

    Cuplikan layar berikut menampilkan pengaturan tambahan di bagian **Peluasan Skala** pada panel **App Service**.

    ![Panel aturan skala dari kondisi skala default pada panel API web Azure](./media/l11_scale_web_app_rule.png)

    > **Catatan**: Tunggu hingga operasi penyimpanan selesai sebelum Anda melanjutkan lab ini.

#### <a name="review"></a>Tinjauan

Dalam latihan ini, Anda telah membuat sumber daya Azure yang akan Anda gunakan untuk sisa lab.

### <a name="exercise-2-monitor-a-local-web-api-by-using-application-insights"></a>Latihan 2: Memantau API web lokal dengan menggunakan Application Insights

#### <a name="task-1-build-a-net-web-api-project"></a>Tugas 1: Membuat proyek API Web .NET

1.  Dari komputer lab, mulai **Visual Studio Code**.

1.  Di Visual Studio Code, pada menu **File**, pilih **Buka Folder**.

1.  Di jendela **Buka Folder**, telusuri ke **Allfiles (F):\\Allfiles\\Labs\\11\\Starter\\Api**, lalu tekan **Pilih Folder**.

1.  Di jendela **Visual Studio Code**, aktifkan menu pintasan, lalu pilih **Buka di Terminal Terintegrasi**.

1.  Pada perintah terminal, jalankan perintah berikut untuk membuat aplikasi API Web .NET baru bernama **SimpleApi** di direktori saat ini:

    ```
    dotnet new webapi --output . --name SimpleApi
    ```

1.  Jalankan perintah berikut untuk mengimpor versi 2.18.0 dari **Microsoft.ApplicationInsights** dari NuGet ke proyek saat ini:

    ```
    dotnet add package Microsoft.ApplicationInsights --version 2.18.0
    ```

    > **Catatan**: Perintah **dotnet add package** akan menambahkan paket **Microsoft.ApplicationInsights** dari NuGet. Untuk informasi selengkapnya, lihat [Microsoft.ApplicationInsights](https://www.nuget.org/packages/Microsoft.ApplicationInsights/).

1.  Jalankan perintah berikut untuk mengimpor versi 2.18.0 dari **Microsoft.ApplicationInsights.AspNetCore** dari NuGet:

    ```
    dotnet add package Microsoft.ApplicationInsights.AspNetCore --version 2.18.0
    ```

    > **Catatan**: Perintah **dotnet add package** akan menambahkan paket **Microsoft.ApplicationInsights.AspNetCore** dari NuGet. Untuk informasi selengkapnya, lihat [Microsoft.ApplicationInsights.AspNetCore](https://www.nuget.org/packages/Microsoft.ApplicationInsights.AspNetCore).

1.  Pada perintah terminal, jalankan perintah berikut untuk mengimpor versi 2.18.0 dari **Microsoft.ApplicationInsights.PerfCounterCollector** dari NuGet ke proyek saat ini:

    ```
    dotnet add package Microsoft.ApplicationInsights.PerfCounterCollector --version 2.18.0
    ```

    > **Catatan**: Perintah **dotnet add package** akan menambahkan paket **Microsoft.ApplicationInsights.PerfCounterCollector** dari NuGet. Untuk informasi selengkapnya, lihat [Microsoft.ApplicationInsights.PerfCounterCollector](https://www.nuget.org/packages/Microsoft.ApplicationInsights.PerfCounterCollector/).

1.  Pada perintah terminal, jalankan perintah berikut untuk membangun API Web .NET:

    ```
    dotnet build
    ```

#### <a name="task-2-update-app-code-to-disable-https-and-use-application-insights"></a>Tugas 2: Memperbarui kode aplikasi untuk menonaktifkan HTTPS dan menggunakan Application Insights

1.  Di jendela **Visual Studio Code**, pada panel **Penjelajah**, pilih file **Startup.cs** untuk membuka file di panel **editor**.

1.  Pada panel **editor**, di kelas **Pengaktifan**, cari dan hapus kode berikut pada baris 39:

    ```csharp
    app.UseHttpsRedirection();
    ```

    > **Catatan**: Baris kode ini memaksa API web untuk menggunakan HTTPS. Untuk lab ini, hal ini tidak diperlukan.

1.  Di awal definisi kelas **Pengaktifan**, tambahkan konstanta string statik baru bernama **INSTRUMENTATION_KEY** dengan nilai yang diatur ke kunci instrumentasi sumber daya Application Insights yang Anda catat sebelumnya di lab ini:

    ```csharp
    private const string INSTRUMENTATION_KEY = "instrumentation_key";
    ```

    > **Catatan**: Misalnya, jika kunci instrumentasi Anda adalah `d2bb0eed-1342-4394-9b0c-8a56d21aaa43`, baris kode tersebut akan menjadi `private const string INSTRUMENTATION_KEY = "d2bb0eed-1342-4394-9b0c-8a56d21aaa43";`

1.  Temukan metode **ConfigureServices** di kelas **Pengaktifan**:

    ```csharp
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddControllers();
    }
    ```

1.  Mulai dari baris baru, tambahkan kode berikut di akhir metode **ConfigureServices** untuk mengonfigurasi Application Insights menggunakan kunci instrumentasi yang disediakan:

    ```csharp
    services.AddApplicationInsightsTelemetry(INSTRUMENTATION_KEY);
    ```

1.  Tinjauan metode **ConfigureServices**, yang seharusnya berisi kode berikut:

    ```csharp
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddControllers();
        services.AddApplicationInsightsTelemetry(INSTRUMENTATION_KEY);        
    }
    ```

1.  Simpan file **Startup.cs**.

1.  Pada perintah terminal, jalankan perintah berikut untuk membangun API Web .NET.

    ```
    dotnet build
    ```

#### <a name="task-3-test-an-api-application-locally"></a>Tugas 3: Menguji aplikasi API secara lokal

1.  Pada perintah terminal, jalankan perintah berikut, lalu pilih **Enter** untuk membuat sertifikat. Pilih **YA** pada opsi yang diminta.

    ```
    dotnet dev-certs https --trust
    ```

1.  Pada perintah terminal, jalankan perintah berikut untuk meluncurkan API Web .NET.

    ```
    dotnet run
    ```

1.  Dari taskbar, buka menu konteks untuk ikon **Microsoft Edge**, lalu buka jendela browser baru.

1.  Di jendela browser yang terbuka, navigasikan ke halaman tempat URL berisi jalur relatif **/weatherforecast** dari API web Anda, yang saat ini dihosting di **localhost** pada port **5000**.
    
    > **Catatan**: URL lengkapnya adalah `http://localhost:5000/weatherforecast`.

    > **Catatan**: Halaman harus berisi output dalam format berikut:

    ```
    [{"date":"2021-09-04T10:15:04.0969996-07:00","temperatureC":54,"temperatureF":129,"summary":"Sweltering"},{"date":"2021-09-05T10:15:04.0972401-07:00","temperatureC":44,"temperatureF":111,"summary":"Balmy"},{"date":"2021-09-06T10:15:04.0976549-07:00","temperatureC":41,"temperatureF":105,"summary":"Scorching"},{"date":"2021-09-07T10:15:04.0976613-07:00","temperatureC":-4,"temperatureF":25,"summary":"Freezing"},{"date":"2021-09-08T10:15:04.0976618-07:00","temperatureC":33,"temperatureF":91,"summary":"Balmy"}]
    ```

1.  Tutup jendela browser yang menampilkan halaman yang dibuat oleh `http://localhost:5000/weatherforecast`.

1.  Di Visual Studio Code, pilih **Hentikan Terminal** (ikon **Keranjang Sampah**) untuk menutup panel **terminal** dan semua proses terkait.

#### <a name="task-4-review-metrics-in-application-insights"></a>Tugas 4: Meninjau metrik di Application Insights

1.  Di komputer lab Anda, alihkan ke jendela browser **Microsoft Edge** yang menampilkan portal Microsoft Azure.

1.  Di portal Microsoft Azure, navigasikan kembali ke panel sumber daya Application Insights **instrm** _[yourname]_ yang Anda buat sebelumnya di lab ini.

1.  Pada panel **Application Insights**, di petak peta di tengah panel, temukan metrik yang ditampilkan. Secara khusus, temukan jumlah permintaan server yang telah terjadi dan waktu respons rata-rata server.

    Cuplikan layar berikut menampilkan metrik **Application Insights** dari aplikasi web lokal.

    ![Metrik Application Insights dari aplikasi web lokal di portal Microsoft Azure](./media/l11_web_app_metrics_portal.png)

    > **Catatan**: Diperlukan waktu hingga lima menit untuk mengamati permintaan di bagan metrik Application Insights.

#### <a name="review"></a>Tinjauan

Dalam latihan ini, Anda membuat aplikasi API dengan menggunakan ASP.NET dan mengonfigurasinya untuk mengalirkan metrik aplikasi ke Application Insights. Anda kemudian menggunakan dasbor Application Insights untuk meninjau detail performa tentang API Anda.

### <a name="exercise-3-monitor-a-web-api-using-application-insights"></a>Latihan 3: Memantau API web menggunakan Application Insights

#### <a name="task-1-deploy-an-application-to-the-web-api"></a>Tugas 1: Menyebarkan aplikasi ke API web

1.  Di komputer lab, alihkan ke Visual Studio Code.

1.  Di jendela **Visual Studio Code**, di panel **Penjelajah**, navigasikan ke direktori **bin\Debug\netcoreapp3.1**.

    > **Catatan**: Untuk memverifikasi bahwa Anda berada di direktori **bin\Debug\netcoreapp3.1**, di Visual Studio Code, pada menu File, pilih Buka Folder dan telusuri ke **Allfiles (F):\\Allfiles \\Labs\\11\\Starter\\Api\\bin\\Debug\\netcoreapp3.1**, lalu tekan **Pilih Folder**.

1.  Tambahkan file bernama **web.config** ke direktori.

1.  Buka file **web.config** dan tambahkan konten berikut:

    ```
    <?xml version="1.0" encoding="utf-8"?>
    <configuration>
      <location path="." inheritInChildApplications="false">
        <system.webServer>
          <handlers>
            <add name="aspNetCore" path="*" verb="*" modules="AspNetCoreModuleV2" resourceType="Unspecified" />
          </handlers>
          <aspNetCore processPath="dotnet" arguments=".\SimpleApi.dll" stdoutLogEnabled="false" stdoutLogFile=".\logs\stdout" hostingModel="inprocess" />
        </system.webServer>
      </location>
    </configuration>
    ```

1.  Simpan dan tutup file.

1.  Di jendela **Visual Studio Code**, aktifkan menu pintasan, lalu pilih **Buka di Terminal Terintegrasi**.

1.  Pada perintah terminal, jalankan perintah berikut untuk memastikan bahwa direktori saat ini diatur ke **Allfiles (F):\\Allfiles\\Labs\\11\\Starter\\Api\\ bin\\Debug\\netcoreapp3.1**, tempat file penyebaran berada:

    ```
    cd F:\Allfiles\Labs\11\Starter\Api\bin\Debug\netcoreapp3.1
    ```

1.  Jalankan perintah berikut untuk membuat file zip yang berisi proyek pemula yang akan Anda sebarkan di sebelah API web Azure:

    ```powershell
    Compress-Archive -Path * -DestinationPath api.zip
    ```

1.  Pada perintah terminal, jalankan perintah berikut ini untuk masuk ke langganan Azure Anda menggunakan Azure PowerShell:

    ```powershell
    Connect-AzAccount
    ```

1.  Ikuti instruksi yang ditampilkan pada perintah terminal dengan beralih ke browser Microsoft Edge yang menampilkan portal Microsoft Azure, membuka tab lain di jendela browser, menavigasi ke `https://microsoft.com/devicelogin`, saat diminta, memasukkan kode yang disediakan, lalu masuk dengan akun yang akan Anda gunakan untuk lab ini.

    > **Catatan**: Tunggu hingga proses masuk selesai.

1.  Tutup tab browser yang baru dibuka dan beralih kembali ke perintah terminal di jendela Visual Studio Code.

1.  Jalankan perintah berikut untuk menampilkan daftar semua aplikasi web di grup sumber daya **MonitoredAssets**:

    ```powershell
    Get-AzWebApp -ResourceGroupName MonitoredAssets
    ```

1.  Jalankan perintah berikut untuk menampilkan daftar aplikasi web di grup sumber daya **MonitoredAssets**, yang namanya dimulai dengan **smpapi\*** :

    ```powershell
    Get-AzWebApp -ResourceGroupName MonitoredAssets | Where-Object {$_.Name -like 'smpapi*'}
    ```

1.  Jalankan perintah berikut untuk menampilkan nama aplikasi web pertama yang diidentifikasi pada langkah sebelumnya dan simpan dalam variabel bernama **$webAppName**:

    ```powershell
    Get-AzWebApp -ResourceGroupName MonitoredAssets | Where-Object {$_.Name -like 'smpapi*'} | Select-Object -ExpandProperty Name
    $webAppName = (Get-AzWebApp -ResourceGroupName MonitoredAssets | Where-Object {$_.Name -like 'smpapi*'})[0] | Select-Object -ExpandProperty Name
    ```

1.  Jalankan perintah berikut untuk menyebarkan file **api.zip** yang Anda buat sebelumnya dalam tugas ini ke API web yang namanya Anda identifikasi di langkah sebelumnya:

    ```powershell
    az webapp deployment source config-zip --resource-group MonitoredAssets --src api.zip --name $webAppName
    ```

    > **Catatan**: Jika diminta untuk mengautentikasi, jalankan `az login` dan ikuti instruksi untuk menyelesaikan proses masuk.

    > **Catatan**: Tunggu hingga penyebaran selesai sebelum Anda melanjutkan lab ini.

    > **Catatan**: Tinjauan output dari perintah dan pastikan bahwa `provisioningState` diatur ke `Succeeded`. Output dari perintah harus memiliki format berikut:

    ```
    Getting scm site credentials for zip deployment
    Starting zip deployment. This operation can take a while to complete ...
    Deployment endpoint responded with status code 202
    {
        "active": true,
        "author": "N/A",
        "author_email": "N/A",
        "complete": true,
        "deployer": "ZipDeploy",
        "end_time": "2021-09-03T17:02:18.124062Z",
        "id": "f5fb8ef6a11d4f8387f09dc47628007e",
        "is_readonly": true,
        "is_temp": false,
        "last_success_end_time": "2021-09-03T17:02:18.124062Z",
        "log_url": "https://smpapianu.scm.azurewebsites.net/api/deployments/latest/log",
        "message": "Created via a push deployment",
        "progress": "",
        "provisioningState": "Succeeded",
        "received_time": "2021-09-03T17:02:11.942626Z",
        "site_name": "smpapianu",
        "start_time": "2021-09-03T17:02:12.1613438Z",
        "status": 4,
        "status_text": "",
        "url": "https://smpapianu.scm.azurewebsites.net/api/deployments/latest"
    }
    ```

1.  Di komputer lab, luncurkan jendela browser Microsoft Edge lainnya.

1.  Di jendela browser, navigasikan ke aplikasi API Web Azure tempat Anda menyebarkan aplikasi API sebelumnya dalam tugas ini dengan menambahkan ke URL aplikasi API (yang Anda catat sebelumnya di lab ini) yang memiliki akhiran **/weatherforecast**.

    > **Catatan**: Misalnya, jika URL Anda adalah `https://smpapianu.azurewebsites.net`, URL baru akan menjadi `https://smpapianu.azurewebsites.net/weatherforecast`.

1.  Pastikan bahwa output menyerupai output yang dihasilkan saat menjalankan aplikasi API secara lokal.

    > **Catatan**: Output akan menyertakan nilai yang berbeda tetapi harus memiliki format yang sama.

    > **Catatan**: Jika Anda mendapatkan pengecualian, pastikan konten file **web.config** cocok dengan contoh yang ditampilkan sebelumnya dalam tugas ini. Jika tidak cocok, buat perubahan yang diperlukan dan buat ulang file **api.zip** dan sebarkan kembali.

#### <a name="task-2-configure-in-depth-metric-collection-for-web-apps"></a>Tugas 2: Mengonfigurasi kumpulan metrik mendalam untuk Web Apps

1.  Di komputer lab Anda, alihkan ke jendela browser **Microsoft Edge** yang menampilkan portal Microsoft Azure.

1.  Di portal Microsoft Azure, navigasikan kembali ke panel sumber daya aplikasi web **smpapi** _[yourname]_ yang Anda buat sebelumnya di lab ini.

1.  Pada panel **App Service**, pilih **Application Insights**.

1.  Pada panel **Application Insights**, lakukan tindakan berikut, pilih **Terapkan**, lalu dalam dialog konfirmasi, pilih **Ya**:

    | Pengaturan                         | Tindakan                                                       |
    | ------------------------------- | ------------------------------------------------------------ |
    | Penggeser **Application Insights** | Pastikan penggeser diatur ke **Aktifkan**.|
    | Bagian **Atur aplikasi Anda**    | Pilih tab **.NET Core**.|
    | Bagian **Tingkat kumpulan**    | Pilih **Disarankan**. |
    | Bagian **Profiler**      | Pilih **Aktif**.|
    | Bagian **Debugger snapshot** | Pilih **Nonaktif**.|
    | Bagian **Perintah SQL** | Pilih **Nonaktif**.|


    Cuplikan layar berikut menampilkan pengaturan **Application Insights** dari API Web Azure.

    ![Pengaturan Application Insights dari API Web Azure](./media/l11_web_api_insights.png)

1.  Beralih ke tab browser yang Anda buka di tugas sebelumnya untuk menampilkan hasil penyebaran aplikasi API Anda ke aplikasi API Azure target (termasuk jalur relatif **/weatherforecast** di URL target) dan refresh halaman browser beberapa kali.

1.  Tinjauan output berformat JSON yang dihasilkan oleh API.

1.  Catat URL yang Anda gunakan untuk mengakses output berformat JSON.

    > **Catatan**: URL harus dalam format `https://smpapianu.azurewebsites.net/weatherforecast` jika **smpapianu** adalah nama situs yang Anda buat sebelumnya.

#### <a name="task-3-get-updated-metrics-in-application-insights"></a>Tugas 3: Mendapatkan metrik yang diperbarui di Application Insights

1.  Kembali ke jendela browser yang menampilkan aplikasi web Azure di portal Microsoft Azure.

1.  Pada panel **Application Insights** dari aplikasi web, pilih tautan **Lihat data Application Insights**.

1.  Pada panel **Application Insights**, tinjau metrik yang dikumpulkan di petak peta di tengah panel, termasuk jumlah permintaan server yang telah terjadi dan waktu respons server rata-rata.

    Cuplikan layar berikut menampilkan metrik **Application Insights** dari aplikasi web Azure di portal Microsoft Azure.

    ![Metrik Application Insights dari aplikasi web Azure di portal Microsoft Azure](./media/l11_azure_web_app_metrics_portal.png)

    > **Catatan**: Diperlukan waktu hingga lima menit agar metrik yang diperbarui muncul di bagan metrik Application Insights.

#### <a name="task-4-view-real-time-metrics-in-application-insights"></a>Tugas 4: Melihat metrik real time di Application Insights

1.  Pada panel **Application Insights**, di bagian **Selidiki**, pilih **Metrik langsung**.

1.  Beralih kembali ke jendela browser yang menampilkan aplikasi API target yang berjalan di aplikasi web Azure target (yang menargetkan jalur relatif **/weatherforecast** di URL target), lalu segarkan halaman browser beberapa kali.

1.  Beralih ke jendela browser yang menampilkan panel **Metrik langsung** dan tinjau kontennya.

    > **Catatan**: Bagian **Permintaan Masuk** akan diperbarui dalam beberapa detik, menampilkan permintaan yang Anda buat ke API web.

### <a name="exercise-4-application-insights-logging-with-net-core"></a>Latihan 4: Pengelogan Application Insights dengan .NET Core

#### <a name="task-1-configure-logging-for-a-net-core-api-app"></a>Tugas 1: Mengonfigurasi pengelogan untuk aplikasi API .NET Core

1.  Beralih ke jendela **Visual Studio Code**.

1.  Pada perintah terminal, jalankan perintah berikut untuk mengatur direktori saat ini ke **Allfiles (F):\\Allfiles\\Labs\\11\\Starter\\Api**, tempat file penyebaran berada:

    ```
    cd F:\Allfiles\Labs\11\Starter\Api
    ```

1.  Jalankan perintah berikut untuk mengimpor versi 2.18.0 dari **Microsoft.Extensions.Logging.ApplicationInsights** dari NuGet ke proyek saat ini:

    ```
    dotnet add package Microsoft.Extensions.Logging.ApplicationInsights --version 2.18.0
    ```

    > **Catatan**: Perintah **dotnet add package** akan menambahkan paket **Microsoft.ApplicationInsights** dari NuGet. Untuk informasi selengkapnya, lihat [Microsoft.Extensions.Logging.ApplicationInsights](https://www.nuget.org/packages/Microsoft.Extensions.Logging.ApplicationInsights).

1.  Di jendela **Visual Studio Code**, di panel **Penjelajah**, navigasikan ke direktori **Pengontrol**, lalu buka file **WeatherForecastController.cs**.

1.  Tinjauan konten file dan perhatikan bahwa konten file menyertakan arahan `using Microsoft.Extensions.Logging` dan injeksi konstruktor untuk antarmuka <WeatherForecastController>ILogger umum.

    ```csharp
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Mvc;
    using Microsoft.Extensions.Logging;
    namespace SimpleApi.Controllers
    {
        [ApiController]
        [Route("[controller]")]
        public class WeatherForecastController : ControllerBase
        {
            private static readonly string[] Summaries = new[]
            {
                "Freezing", "Bracing", "Chilly", "Cool", "Mild", "Warm", "Balmy", "Hot", "Sweltering", "Scorching"
            };
            private readonly ILogger<WeatherForecastController> _logger;
            public WeatherForecastController(ILogger<WeatherForecastController> logger)
            {
                _logger = logger;
            }
            [HttpGet]
            public IEnumerable<WeatherForecast> Get()
            {
                var rng = new Random();
                return Enumerable.Range(1, 5).Select(index => new WeatherForecast
                {
                    Date = DateTime.Now.AddDays(index),
                    TemperatureC = rng.Next(-20, 55),
                    Summary = Summaries[rng.Next(Summaries.Length)]
                })
                .ToArray();
            }
        }
    }
    ```

    > **Catatan**: Anda akan memanfaatkan konfigurasi ini untuk menerapkan pengelogan kustom. Saat ini, konstruktor menampilkan grup lima prakiraan cuaca yang dibuat secara acak. Anda akan mengubah pengontrol untuk menampilkan prakiraan satu per satu. Untuk setiap prakiraan, Anda akan membuat entri log informasi, peringatan, atau kesalahan yang menunjukkan jenis cuaca (ringan, parah, dan ekstrem). Setelah entri log ini dicatat oleh Application Insights di ruang kerja Analitik Log yang sesuai, setiap entri akan memiliki tingkat keparahan yang ditetapkan secara otomatis 1, 2, atau 3. 

1.  Temukan baris `var rng = new Random();` dalam metode `public IEnumerable<WeatherForecast> Get()` dalam file **WeatherForecastController.cs**, lalu tambahkan kode berikut yang dimulai dengan baris berikutnya:

    ```csharp
            int temperatureC = rng.Next(-20, 55);
            var summaryId = rng.Next(Summaries.Length);
            switch (summaryId)
            {
                case 0: case 9:
                _logger.LogError("WeatherForecast: extreme weather");
                break;
                case 1: case 2: case 7: case 8:
                _logger.LogWarning("WeatherForecast: severe weather");
                break;
                default:
                _logger.LogInformation("WeatherForecast: mild weather");
                break;
            }
    ```

1.  Ubah pernyataan `return` sehingga memiliki konten berikut:

    ```csharp
            return Enumerable.Range(1, 1).Select(index => new WeatherForecast
            {
                Date = DateTime.Now.AddDays(index),
                TemperatureC = temperatureC,
                Summary = Summaries[summaryId]
            })
            .ToArray();
    ```

1.   Simpan dan tutup file.

1.  Pada perintah terminal, jalankan perintah berikut untuk membangun API Web .NET:

    ```
    dotnet build
    ```

#### <a name="task-2-test-logging-of-a-net-core-api-app"></a>Tugas 2: Menguji pengelogan aplikasi API .NET Core

1.  Jalankan perintah berikut untuk meluncurkan API Web .NET.

    ```
    dotnet run
    ```

    > **Catatan**: Tetap jalankan API web dan pantau output dari panel **terminal** Visual Studio Code saat Anda melakukan langkah selanjutnya dalam tugas ini.

1.  Di komputer lab Anda, dari taskbar, buka menu konteks untuk ikon **Microsoft Edge**, lalu buka jendela browser baru.

    > **Catatan**: Posisikan jendela browser agar tidak menghalangi panel **terminal** Visual Studio Code.

1.  Di jendela browser yang terbuka, navigasikan ke `http://localhost:5000/weatherforecast`, lalu segarkan halaman beberapa kali.

    > **Catatan**: Setiap kali Anda menyegarkan halaman, halaman akan menampilkan prakiraan cuaca yang berbeda dalam format berikut.

    ```
    [{"date":"2021-09-04T14:35:29.0789168-07:00","temperatureC":2,"temperatureF":35,"summary":"Sweltering"}]
    ```

    > **Catatan**: Setiap penyegaran halaman harus menghasilkan tampilan pesan informasi, peringatan, atau kesalahan pada perintah terminal, dalam format berikut:

    ```
    warn: SimpleApi.Controllers.WeatherForecastController[0]
      WeatherForecast: severe weather
    ```

    > **Catatan**: Segarkan halaman beberapa kali untuk memastikan bahwa Anda membuat setidaknya satu pesan untuk setiap jenis (**info**, **peringatan**, dan **kegagalan**).

1.  Biarkan aplikasi API berjalan.

#### <a name="task-3-review-the-application-insights-logging"></a>Tugas 3: Meninjau pengelogan Application Insights

1.  Di komputer lab Anda, alihkan ke jendela browser **Microsoft Edge** yang menampilkan portal Microsoft Azure.

1.  Di portal Microsoft Azure, navigasikan kembali ke panel sumber daya Application Insights **instrm** _[yourname]_ yang Anda buat sebelumnya di lab ini.

1.  Pada panel **Application Insights**, di bagian **Pemantauan**, pilih **Log**.

1.  Jika perlu, tutup panel **Selamat Datang di Analitik Log** dan panel **Kueri**.

1.  Di panel **Kueri Baru**, ketik kueri berikut dan pilih **Jalankan**:

    ```
    traces
    | order by timestamp desc
    ```

1.  Tinjauan hasil kueri.

    > **Catatan**: Hasilnya harus menyertakan entri log yang sesuai dengan pesan peringatan dan kesalahan yang dihasilkan oleh aplikasi api .NET Core, dengan tingkat keparahannya masing-masing (2 dan 3).

    > **Catatan**: Diperlukan waktu hingga lima menit untuk mengamati permintaan di bagan metrik Application Insights.

    Cuplikan layar berikut menampilkan hasil kueri log pada panel **Log Application Insights**.

    ![Mencatat hasil kueri pada panel Log Application Insights](./media/l11_web_api_insights_logs.png)

    > **Catatan**: Anda dapat menyebarkan aplikasi API yang diperbarui ke aplikasi web Azure untuk mengumpulkan log aplikasi web Azure menggunakan Application Insights dengan cara yang setara.

    > **Catatan**: Anda dapat memperluas tingkat pengelogan Application Insights untuk menyertakan peristiwa informasi dengan memodifikasi file **appsettings.Development.json** (atau **appsettings.json**) seperti yang digambarkan dalam daftar kode berikut. Tetapi, Anda harus ingat bahwa hal ini akan sangat meningkatkan volume log, yang memiliki potensi performa jaringan dan implikasi harga:

    ```
    {
      "Logging": {
        "LogLevel": {
          "Default": "Information",
          "Microsoft": "Warning",
          "Microsoft.Hosting.Lifetime": "Information"
        },
        "ApplicationInsights": {
          "LogLevel": {
            "Microsoft": "Information"
          }
        }
      }
    }
    ```

1.  Tutup jendela browser yang menampilkan output aplikasi API Anda.

1.  Beralih ke jendela **Visual Studio Code**, lalu pilih **Hentikan Terminal** (ikon **Keranjang Sampah**) untuk menutup panel **terminal** dan semua proses terkait.

#### <a name="review"></a>Tinjauan

Dalam latihan ini, Anda mengonfigurasi dan menguji pengelogan Application Insights dari aplikasi API web Anda.

### <a name="exercise-5-clean-up-your-subscription"></a>Latihan 5: Membersihkan langganan Anda

#### <a name="task-1-open-azure-cloud-shell"></a>Tugas 1: Membuka Azure Cloud Shell

1.  Di portal Microsoft Azure, pilih ikon **Cloud Shell** ![ikon Cloud Shell](./media/az204_lab_CloudShell.png) untuk membuka sesi PowerShell baru. Jika sesi Cloud Shell default ke PowerShell, pilih **PowerShell**, dan di menu drop-down, pilih **Bash**.

    > **Catatan**: Jika ini pertama kalinya Anda memulai **Cloud Shell**, saat diminta untuk memilih **Bash** atau **PowerShell**, pilih **Bash**. Saat Anda melihat pesan **Anda tidak memiliki penyimpanan yang terpasang**, pilih langganan yang Anda gunakan di lab ini, dan pilih **Buat penyimpanan**.

#### <a name="task-2-delete-resource-groups"></a>Tugas 2: Menghapus grup sumber daya

1.  Pada panel **Cloud Shell**, jalankan perintah berikut untuk menghapus grup sumber daya **MonitoredAssets**:

    ```
    az group delete --name MonitoredAssets --no-wait --yes
    ```

    > **Catatan**: Perintah dijalankan secara asinkron (seperti yang ditentukan oleh parameter *--no-wait*), jadi meskipun Anda dapat menjalankan perintah Azure CLI lain segera setelahnya dalam sesi Bash yang sama, akan memakan waktu beberapa menit sebelum grup sumber daya benar-benar dihapus.

1.  Tutup panel **Cloud Shell** di portal.

#### <a name="task-3-close-the-active-applications"></a>Tugas 3: Menutup aplikasi yang aktif

1.  Tutup aplikasi Microsoft Edge yang sedang berjalan.

1.  Tutup aplikasi Visual Studio Code yang sedang berjalan.

#### <a name="review"></a>Tinjauan

Dalam latihan ini, Anda membersihkan langganan Anda dengan menghapus grup sumber daya yang digunakan di lab ini.
